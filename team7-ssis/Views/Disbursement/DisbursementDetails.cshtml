@model team7_ssis.ViewModels.DisbursementFormViewModel

@{
    ViewBag.Title = "Disbursement Details";
}

@section Scripts {
    <script src="~/Scripts/Custom/RedirectPost.js"></script>
}

@if (ViewBag.Error == true)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        An unexpected error occured.
    </div>
}

<div class="row">
    <div class="col-md-8">
        <h2 class="mb-3">Disbursement Form #@Model.DisbursementId</h2>
    </div>
    <div class="col-md-4">
        <i class="fa fa-print pull-right" aria-hidden="true"></i>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="label">Representative</div>
        @Model.Representative
    </div>
    <div class="col-md-4">
        <div class="label">Department</div>
        @Model.Department
    </div>
    <div class="col-md-4">
        <div class="label">Order Time</div>
        @Model.OrderTime
    </div>
    <div class="col-md-12">
        <div class="label">Collection Point</div>
        @Model.CollectionPoint
    </div>
</div>

<table id="myTable" class="table table-striped table-bordered" style="width: 100%">
    <thead>
        <tr>
            <th>Item Code</th>
            <th>Description</th>
            <th>Qty</th>
        </tr>
    </thead>

</table>

<script>
    $(document).ready(function() {
        var oTable = $('#myTable').DataTable({

            ajax: {
                url: "/api/disbursement/@Model.DisbursementId",
                dataSrc: ""
            },
            columns: [
                { "data": "ItemCode", "autoWidth": true },
                { "data": "Description", "autoWidth": true },
                { "data": "Qty", "autoWidth": true },
            ],
            select: true
        });
    })

    $(document).on('click', '#confirm', function () {
        post("/Disbursement/Collect", { did : "@Model.DisbursementId" });
    })

</script>

<div class="row mt-3">
    <div class="col-md-12">
        <button class="btn btn-default" onclick="window.history.go(-1)">Back</button>
        @if (Model.Status == 11)
        {
            <button id="confirm" class="btn btn-success"><i class="fa fa-check" aria-hidden="true"></i> Confirm Delivery</button>
        }
    </div>
</div>
